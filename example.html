<html>
<body>
<script type="module">
    import {fnstate, fnbind, fnlink, div, br, input, hr, h4, span, p, router, route} from "./src/index.js"

    const appState = fnstate( { currentUser: null } )

    const card = ( { title, content } ) =>
        div( { style: 'display: inline-block; border: 2px solid black; border-radius: 5px; padding: 10px' },
             h4( { class: 'card-title' }, title ),
             hr(),
             div( { class: 'card-content' }, content )
        )

    const greeting = () => {
        //state that's private to this component
        const greetingState = fnstate( { greeting: 'Hello' } )

        //create a variable to store our created div so that it doesn't get re-created on every update
        const greetingDiv =  div(

            //bind to any number of states by passing an array
            fnbind( [ appState, greetingState ],
                    () => `${greetingState.greeting} ${appState.currentUser.name}!`
            ),
            br(), br(),

            //bind to our private state
            fnbind( greetingState,
                    input( {
                               value: greetingState.greeting,

                               //setting this property will update all bound elements
                               oninput: ( e ) => {greetingState.greeting = e.target.value}
                           } ),

                    //the update function that defines what happens when the state gets updated.
                    ( el, st ) => el.value = st.greeting
            ),

            //bind to our app state
            fnbind( appState,
                    input( {
                               value: appState.currentUser.name,
                               oninput: ( e ) => {

                                   //updates are only triggered by direct properties of the state
                                   //therefore you need to actually re-assign currentUser to trigger an update
                                   appState.currentUser = Object.assign(appState.currentUser, {
                                       name: e.target.value
                                   })
                               }
                           } ),
                    ( el, st ) => {el.value = st.currentUser.name}
            )
        )
        return fnbind( appState, () => st.currentUser ? greetingDiv : 'Welcome!')
    }

    // document.body.append(
    //     p(
    //         'fntags ',
    //         span( { style: 'color: lime' },
    //               'is javascript'
    //         )
    //     ),
    //     card( { title: 'fntags', content: 'is awesome' } ),
    //     card( { title: 'fntags', content: 'is simple' } ),
    //     p( { class: 'header' },
    //        greeting()
    //     )
    // )

    const nav = div(
        fnlink({to: "/"}, "root"),
        fnlink({to: "/hello"}, "hello"),
        fnlink({to: "/goodbye"}, "goodbye"),
    )
    document.body.append(
        router(
            nav,
            route({fnpath: "/", absolute: true},
                  "rooooot"
            ),
            route({fnpath:"/hello"},
                  "hello page"
            ),
            route({fnpath:"/goodbye"},
                  "goodbye page"
            )
        )
    )

    setTimeout( () => {
                    console.log( 'hello' )
                    appState.currentUser = { name: 'fntags' }
                },
                2000 )

</script>
</body>
</html>