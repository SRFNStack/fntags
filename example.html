<html>
<body>
<script type="module">
    import {fntags, fnbind} from "./src/index.js"
    fntags.hoist()

    const appState = fntags.initState( { currentUser: null } )

    const card = ( { title, content } ) =>
        div( { style: 'display: inline-block; border: 2px solid black; border-radius: 5px; padding: 10px' },
             h4( { class: 'card-title' }, title ),
             hr(),
             div( { class: 'card-content' }, content )
        )

    const greeting = () => {
        //state that's private to this component
        const greetingState = fntags.initState( { greeting: 'Hello' } )

        //create a variable to store our created div so that it doesn't get re-created on every update
        let greetingDiv
        const buildGreetingDiv = () => div(

            //bind to any number of states by passing an array
            fnbind( [ appState, greetingState ],
                    () => `${greetingState.greeting} ${appState.currentUser.name}!`
            ),
            br(), br(),

            //bind to our private state
            fnbind( greetingState,
                    input( {
                               value: greetingState.greeting,

                               //setting this property will update all bound elements
                               oninput: ( e ) => {greetingState.greeting = e.target.value}
                           } ),

                    //the update function that defines what happens when the state gets updated.
                    ( el, st ) => el.value = st.greeting
            ),

            //bind to our app state
            fnbind( appState,
                    input( {
                               value: appState.currentUser.name,
                               oninput: ( e ) => {

                                   //updates are only triggered by direct properties of the state
                                   //therefore you need to actually re-assign currentUser to trigger an update
                                   appState.currentUser = Object.assign(appState.currentUser, {
                                       name: e.target.value
                                   })
                               }
                           } ),
                    ( el, st ) => {el.value = st.currentUser.name}
            )
        )

        if( appState.currentUser ) greetingDiv = buildGreetingDiv()

        return fnbind( appState,
                       () => greetingDiv || 'Welcome!',
                       ( el, st ) => {
                           if( st.currentUser ) {
                               if( !greetingDiv ) greetingDiv = buildGreetingDiv()
                               return greetingDiv
                           } else return 'Welcome!'
                       }
        )
    }

    document.body.append(
        p(
            'fntags ',
            span( { style: 'color: lime' },
                  'is javascript'
            )
        ),
        card( { title: 'fntags', content: 'is awesome' } ),
        card( { title: 'fntags', content: 'is simple' } ),
        p( { class: 'header' },
           greeting()
        )
    )

    setTimeout( () => {
                    console.log( 'hello' )
                    appState.currentUser = { name: 'fntags' }
                },
                2000 )

</script>
</body>
</html>